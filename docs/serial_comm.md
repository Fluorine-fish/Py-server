# 上下位机串口通讯协议

## 协议模板

``` c
typedef struct {
    char start;  // 0 帧头，取 's'
    char datatype; // 1 消息类型
    char command;  // 2 命令字
    uint32_t data[8]; // 3 - 26 数据域，最多存储8个float类型数据
    ··· // 27 - 30 预留空位
    char end;    // 31 帧尾，取 'e'
} SerialPacket;
```
___
## 详细参数分配
### 1.消息类型
| 消息类型 | 描述 |
| -------- | ---- |
| 0xA0 | 上位机控制下位机 |
| 0xB0 | 下位机状态上报 |
### 2.命令字
| 命令字 | 描述 |
| ------ | ---- |
| 0x00 | 上位机开机 |
| 0x01 | 上位机关机 |
| 0x02 | 回到复位状态 |
| 0x10 | 提高光照亮度 |
| 0x11 | 降低光照亮度 |
| 0x12 | 提升光照色温 |
| 0x13 | 降低光照色温 |
| 0x14 | 开灯 |
| 0x15 | 关灯 |
| 0x16 | 上位机设置灯光 | 
| 0x20 | 进行坐姿提醒 |
| 0x21 | 进行远眺提醒 |
| 0x30 | 机械臂向前 |
| 0x31 | 机械臂向后 |
| 0x32 | 机械臂向左 |
| 0x33 | 机械臂向右 |
| 0x34 | 机械臂向上 |
| 0x35 | 机械臂向下 |
| 0x40 | 上位机要求下位机发送状态 |
| 0x41 | 下位机发送状态 |
| 0x50 | 阅读灯光 |
| 0x51 | 学习灯光 |
### 3.数据域
所有的数据类型均为uint32_t,0代表逻辑0,1代表逻辑1.
1. 下位机回传数据域 （0xB0）
    | 数据域索引 | 描述 |
    | ---------- | ---- |
    | 0          | 是否开机 |
    | 1          | 是否开灯 |
    | 2          | 光照亮度 （0-1000）|
    | 3          | 光照色温 （3500K-6000K）|
    | 4          | 留空 |
    | 5          | 留空 |
    | 6          | 留空 |
    | 7          | 留空 |
2. 上位机发送数据域 （0xA0，且仅在不使用数据的时候） 
    | 数据域索引 | 描述 |
    | ---------- | ---- |
    | 0          | 留空 |
    | 1          | 留空 |
    | 2          | 留空 |
    | 3          | 留空 |
    | 4          | 留空 |
    | 5          | 留空 |
    | 6          | 留空 |   
    | 7          | 留空 |
3. 使用`0x16`命令直接设置灯光的数据域
    | 数据域索引 | 描述 |
    | ---------- | ---- |
    | 0          | 光照亮度0-1000）|
    | 1          | 光照色温（3000K-6500K） |
    | 2          | 留空 |
    | 3          | 留空 |
    | 4          | 留空 |
    | 5          | 留空 |
    | 6          | 留空 |
    | 7          | 留空 |
## HEX示例
### 上位机发送数据示例
```
73A0FF0000000000000000000000000000000000000000000000000000000065
```
测试用出队命令
```
73 A0 AF 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 65
```